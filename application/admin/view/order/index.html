{include file="public/header" /}
<style>
	.layui-form-item .layui-input-inline {
		width: 180px
	}
</style>
<fieldset class="layui-elem-field" style="border:0">
	<form class="layui-form" lay-filter="searchForm" id="searchForm">
		<div class="layui-form-item" style="float: left;">
			<div class="layui-input-inline">
				<input type="text" name="order_no" autocomplete="off" placeholder="16位订单号" class="layui-input layui-btn-sm">
			</div>
			<div class="layui-input-inline">
				<input type="text" name="accept_name" autocomplete="off" placeholder="收件人姓名" class="layui-input layui-btn-sm">
			</div>

			<div class="layui-input-inline">
				<input type="text" name="phone" autocomplete="off" placeholder="收件电话" class="layui-input layui-btn-sm">
			</div>
			<div class="layui-input-inline">
				<select name="status">
					<option value="">==订单状态==</option>
					{volist name="status" id="v"}
					<option value="{$key}">{$v}</option>
					{/volist}
				</select>
			</div>
			<button type="submit" lay-submit lay-filter="searchForm" class="layui-btn layui-btn-warm"><i class="fa fa-search"></i> 搜索</button>
		</div>
	</form>
</fieldset>
<div class="hr-line-dashed"></div>
<table id="datatable" lay-filter="datatable"></table>
<script type="text/html" id="toobar">

	<a class="layui-btn layui-btn-xs" lay-event="detail"><i class="fa fa-eye"></i> 订单详情</a>
	{{#  if(d.statusFlag == 5){ }}
	<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="check"><i class="fa fa-hand-o-right"></i> 订单审核</a>
	{{#  } }}
	{{#  if(d.statusFlag == 10){ }}
	<a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="send"><i class="fa fa-truck"></i> 订单发货</a>
	{{#  } }}
	{{#  if(d.statusFlag == 25){ }}
	<a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="return"><i class="fa fa-reply-all"></i> 退货审核</a>
	{{#  } }}

</script>
<script type="text/javascript">
	layui.config({
		base: '/static/admin/js/'
	}).use(['table', 'form', 'layer', 'jquery', 'utils'], function () {
		var table = layui.table, form = layui.form,
			layer = layui.layer, $ = layui.jquery,
			utils = layui.utils;
		var datatable = table.render({
			elem: '#datatable',
			height: 'full-120',
			limit: "{$page_size}",
			url: "{:url('order/index')}?t=" + new Date().getTime(),
			page: true,
			cols: [[
				{field: 'id', title: '序号', align: 'center', width: 80},
				{field: 'order_no', title: '订单号', align: 'center', width: 160},
				{field: 'accept_name', title: '收件人', align: 'center', width: 80},
				{field: 'accept_phone', title: '收件人电话', align: 'center', width: 120},
				{field: 'pay_status', title: '支付状态', align: 'center', width: 120},
				{field: 'status', title: '订单状态', align: 'center', width: 160},
				{field: 'create_time', title: '订单日期', align: 'center', width: 180},
				{title: '操作', align: 'left', toolbar: '#toobar', width: 200}
			]]
		});
		table.on('tool(datatable)', function (obj) {
			var data = obj.data;
			var layEvent = obj.event;
			if (layEvent === 'detail') {
				window.parent.orderInfo(data.id);
			} else if (layEvent === 'check') {

			} else if (layEvent === 'send') {

			} else if (layEvent === 'return') {
				layer.open({
					type: 1,
					title: '用户 【 ' + data.accept_name + ' 】 退货审核',
					area: ['500px', '380px'],
					btnAlign: 'c',
					content: $('#returnHtml').html(),
					shadeClose: true,
					btn: ['审核通过', '审核拒绝'],
					yes: function () {
						ajaxCheck(data.id, 1, '');
					},
					btn2: function () {
						var remark = $.trim($('textarea[name=remark]').val());
						if (remark.length > 200) {
							parent.message.show({skin: 'red', msg: '备注不能超过200个字符'});
							return false;
						}
						if (remark === '') {
							parent.message.show({skin: 'red', msg: '请输入拒绝原因'});
							return false;
						}
						ajaxCheck(data.id, 0, remark);
						return false;
					}
				});
			}
		});
		//监听搜索提交
		form.on('submit(searchForm)', function (data) {
			var order_no = encodeURI($('input[name=order_no]').val());
			var accept_name = encodeURI($('input[name=accept_name]').val());
			var phone = encodeURI($('input[name=phone]').val());
			var status = encodeURI($('select[name=status]').val());
			datatable.reload({
				where: {
					order_no: order_no,
					accept_name: accept_name,
					phone: phone,
					status: status,
					page: 1
				}
			});
			return false;
		});
	});
</script>
<script type="text/html" id="returnHtml">
	<div class="layui-row">
		<div class="layui-col-md12" style="padding:20px">
			<blockquote class="layui-elem-quote layui-quote-nm">友情提示：<br>必须在收到退货的货物后才可以审核，审核通过后会立即发起退款操作</blockquote>
			<form class="layui-form layui-form-pane" lay-filter="rejectForm">
				<div class="layui-form-item layui-form-text">
					<label class="layui-form-label">拒绝原因</label>
					<div class="layui-input-block">
						<textarea name="remark" placeholder="如果通过，不用填写；审核拒绝必须填写理由，不能超过200个字符" class="layui-textarea" style="resize:none"></textarea>
					</div>
				</div>
			</form>
		</div>
	</div>
</script>
{include file="public/footer" /}